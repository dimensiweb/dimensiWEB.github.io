<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" type="text/css"/>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.3/semantic.min.js"></script>
        <script src="js/myjs.js"></script>

        <link rel="stylesheet" type="text/css" href="css/style.css">
        
        <title>BSO DimensiWEB</title>
        <link rel="icon" type="image/gif/png" href="assets/logo dimensiw bw.png ">
    </head>
    <body>
        <div class="ui mediums borderless menu" id="dw-navbar">
            <a class="item"><i class="home icon"></i> Home</a>
            <div class="ui dropdown item">
                DimensiWEB's <i class="dropdown icon"></i>
                <div class="menu">
                    <a class="item" href="#dw-article"><i class="newspaper outline icon"></i> Article</a>
                    <a class="item" href="#dw-gallery"><i class="images outline icon"></i> Gallery</a>
                </div>
            </div>
            <a class="item" href="#aboutus">About Us</a>
            <div class="right menu">
                <a href="https://bit.ly/2kIA0xK">
                    <div class="item">
                        <div class="ui animated primary fade button" tabindex="0">
                            <div class="visible content">Join Us</div>
                                <div class="hidden content">
                                    <i class="large whatsapp icon" style="line-height: .8"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        <div id="dw-sbar">
            <div class="ui open button" id="dw-hamb"><i class="large bars icon"></i></div>
                <div class="ui left vertical sidebar menu">
                <div class="item">
                    <i class="home icon"></i> Home
                </div>
                <div class="ui dropdown item">
                    <i class="dropdown icon"></i>
                    DimensiWEB's
                    <div class="menu">
                        <a class="item" href="#dw-article"><i class="newspaper outline icon"></i> Article</a>
                        <a class="item" href="#dw-article"><i class="images outline icon"></i> Gallery</a>
                    </div>
                </div>
                <a class="item" href="#aboutus">About Us</a>
            </div>
            <a href="https://bit.ly/2kIA0xK">
                <div class="ui animated primary fade button" id="dw-invbut" tabindex="0">
                    <div class="visible content">Join Us</div>
                        <div class="hidden content">
                            <i class="large whatsapp icon" style="line-height: .8"></i>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        <h1 class="ui center aligned icon header">
            JOIN US
        </h1>
        <h3 class="ui center aligned icon header">
            <span>THIS FRIDAY</span>
            <span>4.00 PM @ LAB 4.05</span>
        </h3>
        <h1 class="ui horizontal divider center aligned header">
            <div class="content">
                Article Upload
            </div>
        </h1>
        <div class="dw-container">
            <div class="dw-contbox">
                <div class="dw-imgup">
                <form id="form_upload">
                    <img src="" alt="" id="preview">
                    <i class="huge image outline icon"></i><br>
                    <label for="file-upload" class="dw-upbtn">Upload Image</label>
                    <input id="file-upload" type="file" onchange="previewFile()"/>
                </div>
                <div class="dw-contup">
                    <h2>Upload Content</h2>
                    <input type="text" class="field" placeholder="Your Name" id="nama">
                    <input type="text" class="field" placeholder="Angkatan" id="angkatan">
                    <input type="text" class="field" placeholder="Judul" id="judul">
                    <textarea placeholder="Content Description" class="field" id="content"></textarea>
                    <button type="submit" class="dw-postbtn">Post</button>
                </form>
                </div>
            </div>
        </div>
        <h1 class="ui center aligned header" id="dw-article">
            <img src="assets/logo dimensiw bw.png">
            <div class="content">
                Daily DimensiWEB
            </div>
        </h1>
        <h4 class="ui horizontal divider header">
            <i class="newspaper outline icon"></i> Your Posted Article
        </h4>
        <div class="ui divided items" id="dw-content">
            <!-- <div class="item">
                <div class="image" id="dw-content-image">
                    <img src="assets/crossword.png">
                </div>
                <div class="content">
                    <a class="header" id="dw-content-title">Crossword Script Jawa</a>
                    <div class="meta" id="dw-content-author">
                        <span>By Yayang Kurnia (Angkatan 2017)</span>
                    </div>
                    <div class="description" id="dw-content-description">
                        <p>Sebuah game Crossword (Teka-teki Silang) dibuat menggunakan Script Jawa (Javascript). Lorem ipsum dolor sit amet consectetur adipisicing elit. Neque dolor laboriosam et in vel autem dicta minus perferendis. Dolor earum temporibus quod suscipit soluta veniam possimus blanditiis necessitatibus sit ab!</p>
                    </div>
                    <div class="extra">
                        <div class="ui left floated primary button">
                            Read More
                            <i class="right chevron icon"></i>
                        </div><br><br><br>
                        <div class="left aligned">
                            Rate this Article :
                            <div class="ui star rating" data-rating="3" data-max-rating="5"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="item">
                <div class="image" id="dw-content-image">
                    <img src="assets/imex.png">
                </div>
                <div class="content">
                    <a class="header" id="dw-content-title">Title</a>
                    <div class="meta" id="dw-content-author">
                        <span>By Author (Angkatan xxxx)</span>
                    </div>
                    <div class="description" id="dw-content-description">
                        <p>Dummy Text. Lorem ipsum dolor sit amet consectetur adipisicing elit. Neque dolor laboriosam et in vel autem dicta minus perferendis. Dolor earum temporibus quod suscipit soluta veniam possimus blanditiis necessitatibus sit ab!</p>
                    </div>
                    <div class="extra">
                        <div class="ui left floated primary button">
                            Read More
                            <i class="right chevron icon"></i>
                        </div><br><br><br>
                        <div class="left aligned">
                            Rate this Article :
                            <div class="ui star rating" data-rating="0" data-max-rating="5"></div>
                        </div>
                    </div>
                </div>
            </div> -->
        </div>
        <h4 class="ui horizontal divider header">
            <i class="images outline icon"></i> Our Gallery
        </h4>
        <div class="ui four doubling cards">
            <div id="dw-gallery">
                
            </div>
            <!-- <div class="card">
                <div class="image">
                    <img src="assets/imex.png">
                </div>
            </div>
            <div class="card">
                <div class="image">
                    <img src="assets/imex.png">
                </div>
            </div>
            <div class="card">
                <div class="image">
                    <img src="assets/imex.png">
                </div>
            </div>
            <div class="card">
                <div class="image">
                    <img src="assets/imex.png">
                </div>
            </div> -->
        </div>
        <div class="ui inverted vertical footer segment">
            <div class="logoex" id="aboutus">
                <a href="https://uinsgd.ac.id/"><img src="assets/logo uin.png" alt="UIN Bandung"></a>
                <a href="http://himatif.uinsgd.ac.id/"><img src="assets/logo himatif.png" alt="HIMATIF UIN Bandung"></a>
            </div>
            <div class="penutup">
                <span>&#169; DimensiWEB</span><br>
                <span>All rights belong to their respective owner</span>
            </div>
        </div>

        <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
        
        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyAtyNq-jpPAPWkOqPxfw-k0LdcKuX-jQYg",
                authDomain: "materi-fb.firebaseapp.com",
                databaseURL: "https://materi-fb.firebaseio.com",
                projectId: "materi-fb",
                storageBucket: "materi-fb.appspot.com",
                messagingSenderId: "66417248213",
                appId: "1:66417248213:web:525e42d5aef05913025f5c"
            };

            const fb = firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const storageRef = fb.storage().ref('');
            const nama = document.getElementById('nama');
            const angkatan = document.getElementById('angkatan');
            const content = document.getElementById('content');
            const uploader = document.getElementById('uploader');
            let file_gambar = "";

            database.ref('/tb_gambar/').once('value').then(function (snapshot) {
                if (snapshot.exists()) {
                    let content = '';
                    snapshot.forEach(function (data) {
                        let val = data.val();
                        content += '<div class="card">';
                        content += '<div class="image">';
                        content += `<img src="${val.url}" alt="${val.nama}">`;
                        content += '</div>';
                        content += '</div>';
                    });
                    document.getElementById('dw-gallery').innerHTML = content;
                }
            });

            database.ref('/tb_post/').once('value').then(function (snapshot) {
                if (snapshot.exists()) {
                    let content = '';
                    snapshot.forEach(function (data) {
                        let val = data.val();
                        content += '<div class="item">';
                            content += '<div class="image" id="dw-content-image">';
                                content += `<img src="${val.url}" alt="${val.nama}">`;
                            content += '</div>';
                            content += '<div class="content">';
                                content += '<a class="header" id="dw-content-title">';
                                    content += `${val.judul}`;
                                content += `</a>`;
                                content += '<div class="meta" id="dw-content-author">';
                                    content += `<span>By ${val.nama} (Angkatan ${val.angkatan})</span>`;
                                content += '</div>';
                            content += '<div class="description" id="dw-content-description">';
                                content += `<p>${val.content}</p>`; 
                            content += '</div>';
                        content += '</div>';
                    });
                    document.getElementById('dw-content').innerHTML = content;
                }
            });
            
            function previewFile() {
                let file = document.querySelector('input[type=file]').files[0];
                let metadata = { contentType: 'image/jpeg' };
                file_gambar = file.name;
                let uploadTask = storageRef.child('post/' + file.name).put(file, metadata);
                uploadTask.on('state_changed', function (snapshot) {
                    let percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log(percentage);
                    uploader.value = percentage;
                }, function (error) {
                    console.log('error while uploading')
                }, function () {
                    let starsRef = storageRef.child('post/' + file.name);
                    // starsRef.getDownloadURL().then(function (url) {
                    //     document.querySelector('#preview').src = url;
                    // }).catch(function (error) {
                    //     console.log('error while downloading file');
                    // });
                });
            }

            document.getElementById("form_upload").addEventListener("submit", function (e) {
                e.preventDefault();
                let entry = {};
                let nama = file_gambar;
                let nm_db = "https://firebasestorage.googleapis.com/v0/b/materi-fb.appspot.com/o/post%2F" + nama;
                let media = nm_db + "?alt=media"
                entry.url = media;
                entry.nama = document.getElementById("nama").value;
                entry.angkatan = document.getElementById("angkatan").value;
                entry.content = document.getElementById("content").value;
                let Entry = firebase.database().ref('tb_post');
                Entry.push(entry).then(function (data) {
                    alert("Data berhasil diupload");
                    window.location.href = ''
                });
                return false;
            });
        </script>
    </body>
</html>
